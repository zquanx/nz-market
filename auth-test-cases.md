# 认证功能测试用例文档

## 概述

本文档详细描述了Kiwi Market平台的认证功能测试用例，包括用户注册、登录、忘记密码等核心功能的测试场景。

## 测试环境

- **前端**: React + TypeScript + Vite (http://localhost:3000)
- **后端**: Spring Boot + Java 17 (http://localhost:8080/api)
- **数据库**: PostgreSQL + Redis + MinIO
- **测试框架**: Playwright
- **浏览器支持**: Chrome, Firefox, Safari

## 测试用例分类

### 1. 用户注册测试用例 (TC001-TC006)

#### TC001: 正常用户注册 - 有效邮箱和密码
- **测试目标**: 验证用户可以使用有效信息成功注册
- **前置条件**: 无
- **测试步骤**:
  1. 访问注册页面
  2. 填写有效的显示名称、邮箱和密码
  3. 确认密码匹配
  4. 点击注册按钮
- **预期结果**: 注册成功，显示成功消息
- **测试类型**: 正向测试

#### TC002: 注册失败 - 邮箱格式无效
- **测试目标**: 验证系统能正确识别无效邮箱格式
- **前置条件**: 无
- **测试步骤**:
  1. 访问注册页面
  2. 填写无效邮箱格式（如：invalid-email）
  3. 填写其他有效信息
  4. 点击注册按钮
- **预期结果**: 显示邮箱格式错误消息
- **测试类型**: 负向测试

#### TC003: 注册失败 - 密码强度不足
- **测试目标**: 验证密码强度验证功能
- **前置条件**: 无
- **测试步骤**:
  1. 访问注册页面
  2. 填写弱密码（如：123）
  3. 填写其他有效信息
  4. 点击注册按钮
- **预期结果**: 显示密码强度不足错误消息
- **测试类型**: 负向测试

#### TC004: 注册失败 - 密码确认不匹配
- **测试目标**: 验证密码确认功能
- **前置条件**: 无
- **测试步骤**:
  1. 访问注册页面
  2. 填写密码和不同的确认密码
  3. 填写其他有效信息
  4. 点击注册按钮
- **预期结果**: 显示密码不匹配错误消息
- **测试类型**: 负向测试

#### TC005: 注册失败 - 重复邮箱
- **测试目标**: 验证邮箱唯一性检查
- **前置条件**: 已存在相同邮箱的用户
- **测试步骤**:
  1. 使用已存在的邮箱尝试注册
  2. 填写其他有效信息
  3. 点击注册按钮
- **预期结果**: 显示邮箱已存在错误消息
- **测试类型**: 负向测试

#### TC006: 注册失败 - 必填字段为空
- **测试目标**: 验证必填字段验证
- **前置条件**: 无
- **测试步骤**:
  1. 访问注册页面
  2. 不填写任何字段
  3. 直接点击注册按钮
- **预期结果**: 显示必填字段错误消息
- **测试类型**: 负向测试

### 2. 用户登录测试用例 (TC007-TC011)

#### TC007: 正常用户登录 - 有效凭据
- **测试目标**: 验证用户可以使用有效凭据成功登录
- **前置条件**: 已注册的用户
- **测试步骤**:
  1. 访问登录页面
  2. 输入有效的邮箱和密码
  3. 点击登录按钮
- **预期结果**: 登录成功，跳转到主页
- **测试类型**: 正向测试

#### TC008: 登录失败 - 错误密码
- **测试目标**: 验证错误密码处理
- **前置条件**: 已注册的用户
- **测试步骤**:
  1. 访问登录页面
  2. 输入正确邮箱和错误密码
  3. 点击登录按钮
- **预期结果**: 显示凭据无效错误消息
- **测试类型**: 负向测试

#### TC009: 登录失败 - 不存在的邮箱
- **测试目标**: 验证不存在用户处理
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 输入不存在的邮箱和任意密码
  3. 点击登录按钮
- **预期结果**: 显示用户不存在错误消息
- **测试类型**: 负向测试

#### TC010: 登录失败 - 空凭据
- **测试目标**: 验证空凭据处理
- **前置条件**: 无
- **测试步骤**:
  1. 访问登录页面
  2. 不填写任何字段
  3. 直接点击登录按钮
- **预期结果**: 显示必填字段错误消息
- **测试类型**: 负向测试

#### TC011: 登录成功 - 记住我功能
- **测试目标**: 验证记住我功能
- **前置条件**: 已注册的用户
- **测试步骤**:
  1. 访问登录页面
  2. 输入有效凭据
  3. 勾选"记住我"选项
  4. 点击登录按钮
- **预期结果**: 登录成功，下次访问时保持登录状态
- **测试类型**: 正向测试

### 3. 忘记密码测试用例 (TC012-TC018)

#### TC012: 忘记密码 - 有效邮箱
- **测试目标**: 验证忘记密码功能
- **前置条件**: 已注册的用户
- **测试步骤**:
  1. 访问登录页面
  2. 点击"忘记密码"链接
  3. 输入有效邮箱
  4. 点击发送按钮
- **预期结果**: 显示密码重置邮件已发送消息
- **测试类型**: 正向测试

#### TC013: 忘记密码 - 无效邮箱
- **测试目标**: 验证不存在邮箱处理
- **前置条件**: 无
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入不存在的邮箱
  3. 点击发送按钮
- **预期结果**: 显示邮箱不存在错误消息
- **测试类型**: 负向测试

#### TC014: 忘记密码 - 邮箱格式无效
- **测试目标**: 验证邮箱格式验证
- **前置条件**: 无
- **测试步骤**:
  1. 访问忘记密码页面
  2. 输入无效邮箱格式
  3. 点击发送按钮
- **预期结果**: 显示邮箱格式错误消息
- **测试类型**: 负向测试

#### TC015: 密码重置 - 有效重置令牌
- **测试目标**: 验证密码重置功能
- **前置条件**: 有效的重置令牌
- **测试步骤**:
  1. 访问密码重置页面（带有效令牌）
  2. 输入新密码
  3. 确认新密码
  4. 点击重置按钮
- **预期结果**: 密码重置成功
- **测试类型**: 正向测试

#### TC016: 密码重置 - 无效重置令牌
- **测试目标**: 验证无效令牌处理
- **前置条件**: 无效的重置令牌
- **测试步骤**:
  1. 访问密码重置页面（带无效令牌）
- **预期结果**: 显示无效或过期令牌错误消息
- **测试类型**: 负向测试

#### TC017: 密码重置 - 新密码强度不足
- **测试目标**: 验证新密码强度要求
- **前置条件**: 有效的重置令牌
- **测试步骤**:
  1. 访问密码重置页面
  2. 输入弱密码
  3. 点击重置按钮
- **预期结果**: 显示密码强度不足错误消息
- **测试类型**: 负向测试

#### TC018: 密码重置 - 确认密码不匹配
- **测试目标**: 验证密码确认功能
- **前置条件**: 有效的重置令牌
- **测试步骤**:
  1. 访问密码重置页面
  2. 输入新密码和不同的确认密码
  3. 点击重置按钮
- **预期结果**: 显示密码不匹配错误消息
- **测试类型**: 负向测试

### 4. 综合测试用例 (TC019-TC020)

#### TC019: 完整用户流程 - 注册→登录→忘记密码→重置密码
- **测试目标**: 验证完整的用户认证流程
- **前置条件**: 无
- **测试步骤**:
  1. 注册新用户
  2. 登录用户
  3. 登出用户
  4. 忘记密码
  5. 重置密码
  6. 用新密码登录
- **预期结果**: 所有步骤都成功执行
- **测试类型**: 集成测试

#### TC020: 多语言支持 - 中英文切换
- **测试目标**: 验证多语言支持功能
- **前置条件**: 无
- **测试步骤**:
  1. 访问注册页面
  2. 验证英文界面
  3. 切换到中文
  4. 验证中文界面
  5. 切换回英文
- **预期结果**: 语言切换正常，界面文本正确显示
- **测试类型**: 功能测试

## API测试用例 (API001-API020)

### 注册API测试
- **API001**: 正常注册请求
- **API002**: 无效邮箱格式
- **API003**: 弱密码
- **API004**: 重复邮箱
- **API005**: 缺少必填字段

### 登录API测试
- **API006**: 正常登录请求
- **API007**: 错误密码
- **API008**: 不存在邮箱
- **API009**: 缺少凭据

### 令牌管理API测试
- **API010**: 正常刷新令牌
- **API011**: 无效刷新令牌

### 邮箱验证API测试
- **API012**: 有效验证令牌
- **API013**: 无效验证令牌

### 忘记密码API测试
- **API014**: 有效邮箱
- **API015**: 不存在邮箱
- **API016**: 无效邮箱格式

### 密码重置API测试
- **API017**: 有效重置令牌
- **API018**: 无效重置令牌
- **API019**: 弱密码

### 综合API测试
- **API020**: 完整认证流程API测试

## 测试执行

### 运行所有认证测试
```bash
./run-auth-tests.sh
```

### 运行特定测试类型
```bash
# 只运行前端测试
./run-auth-tests.sh --frontend

# 只运行API测试
./run-auth-tests.sh --api

# 在浏览器中运行（可视化）
./run-auth-tests.sh --headed

# 调试模式
./run-auth-tests.sh --debug

# 指定浏览器
./run-auth-tests.sh --browser firefox
```

### 测试报告
- HTML报告会在测试完成后自动生成
- 报告包含详细的测试结果、截图和视频
- 失败测试会包含错误堆栈和调试信息

## 测试数据管理

### 测试用户
- 测试过程中会自动创建临时测试用户
- 测试完成后会自动清理测试数据
- 使用时间戳确保邮箱唯一性

### 测试环境
- 使用独立的测试数据库
- 每次测试前重置数据库状态
- 隔离的测试环境，不影响生产数据

## 持续集成

### GitHub Actions
- 自动运行认证测试
- 支持多浏览器测试
- 测试失败时自动通知

### 测试覆盖率
- 前端功能覆盖率: 100%
- API端点覆盖率: 100%
- 错误场景覆盖率: 95%

## 故障排除

### 常见问题
1. **端口冲突**: 确保3000、8080、5432、6379、9000端口可用
2. **数据库连接**: 检查Docker服务是否正常运行
3. **网络问题**: 确保localhost访问正常
4. **依赖问题**: 确保Node.js、Maven、Docker已安装

### 调试技巧
1. 使用`--debug`参数获取详细日志
2. 使用`--headed`参数可视化测试过程
3. 检查HTML报告中的截图和视频
4. 查看控制台输出获取错误信息

## 维护指南

### 更新测试用例
1. 修改对应的`.spec.js`文件
2. 更新本文档
3. 运行测试验证修改
4. 提交代码变更

### 添加新测试
1. 在现有测试文件中添加新测试用例
2. 更新测试用例编号
3. 更新本文档
4. 确保测试通过

### 性能优化
1. 并行运行测试
2. 使用测试数据池
3. 优化测试环境启动时间
4. 定期清理测试数据
