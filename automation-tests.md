# 🧪 Kiwi Market 自动化测试场景

## 测试环境配置

### 前置条件
- 前端服务运行在 `http://localhost:3001`
- 后端API运行在 `http://localhost:8080`
- 数据库服务正常运行
- 测试用户账号已创建

### 测试数据
```javascript
const testUsers = {
  buyer: { email: 'buyer@test.com', password: 'Test123!' },
  seller: { email: 'seller@test.com', password: 'Test123!' },
  admin: { email: 'admin@test.com', password: 'Admin123!' }
};

const testItem = {
  title: '测试商品 - iPhone 13',
  description: '九成新iPhone 13，无磕碰，功能正常',
  price: 1200,
  category: 'electronics',
  condition: 'excellent',
  location: 'Auckland, New Zealand'
};
```

---

## 🎯 测试场景列表

### 1. 用户注册和登录流程测试
**测试目标**: 验证用户注册、登录、JWT令牌管理功能

**测试步骤**:
1. 访问注册页面 `/register`
2. 填写用户信息（邮箱、密码、显示名称）
3. 提交注册表单
4. 验证注册成功并自动登录
5. 检查JWT令牌是否正确设置
6. 测试登录功能
7. 验证令牌刷新机制

**预期结果**:
- 注册成功，用户状态为ACTIVE
- 自动发送邮箱验证邮件
- JWT访问令牌和刷新令牌正确生成
- 登录后可以访问受保护的页面

**API端点**:
- `POST /auth/register`
- `POST /auth/login`
- `POST /auth/refresh`

---

### 2. 商品发布和管理测试
**测试目标**: 验证卖家发布商品、编辑、删除功能

**测试步骤**:
1. 以卖家身份登录
2. 访问发布页面 `/sell`
3. 填写商品信息（标题、描述、价格、分类）
4. 上传商品图片（最多10张）
5. 设置商品位置和标签
6. 预览并发布商品
7. 验证商品在个人中心显示
8. 测试编辑商品信息
9. 测试删除商品功能

**预期结果**:
- 商品成功发布，状态为ACTIVE
- 图片正确上传到MinIO存储
- 商品信息在搜索页面可见
- 编辑和删除操作正常

**API端点**:
- `POST /items`
- `PUT /items/{id}`
- `DELETE /items/{id}`
- `POST /uploads/presigned-url`

---

### 3. 商品搜索和筛选测试
**测试目标**: 验证商品搜索、分类筛选、价格范围功能

**测试步骤**:
1. 访问搜索页面 `/search`
2. 测试关键词搜索功能
3. 测试分类筛选（电子产品、服装、家具等）
4. 测试价格范围筛选
5. 测试商品状态筛选（新品、二手、损坏）
6. 测试位置筛选
7. 测试排序功能（价格、时间、热度）
8. 测试分页功能

**预期结果**:
- 搜索结果准确匹配关键词
- 筛选条件正确应用
- 分页和排序功能正常
- 响应时间在可接受范围内

**API端点**:
- `GET /items/search`
- `GET /items/latest`
- `GET /items/popular`

---

### 4. 商品详情和收藏测试
**测试目标**: 验证商品详情展示、收藏功能

**测试步骤**:
1. 以买家身份登录
2. 浏览商品列表，点击进入商品详情
3. 验证商品信息完整显示（图片、描述、价格、卖家信息）
4. 测试图片轮播功能
5. 点击收藏按钮
6. 验证收藏状态更新
7. 访问个人中心查看收藏列表
8. 测试取消收藏功能

**预期结果**:
- 商品详情信息完整准确
- 图片正确加载和轮播
- 收藏功能正常工作
- 收藏列表正确显示

**API端点**:
- `GET /items/{id}`
- `POST /items/{id}/favorite`
- `DELETE /items/{id}/favorite`
- `GET /users/me/favorites`

---

### 5. 实时聊天功能测试
**测试目标**: 验证买卖双方实时聊天功能

**测试步骤**:
1. 买家在商品详情页点击"联系卖家"
2. 验证聊天窗口打开
3. 发送文本消息
4. 验证消息实时显示
5. 测试发送图片消息
6. 测试消息历史记录
7. 测试多设备同步
8. 测试离线消息接收

**预期结果**:
- WebSocket连接正常建立
- 消息实时双向传输
- 消息历史正确保存
- 图片消息正常发送和显示

**API端点**:
- WebSocket: `/ws/chat`
- `GET /chat/conversations`
- `GET /chat/conversations/{id}/messages`
- `POST /chat/conversations/{id}/messages`

---

### 6. 订单创建和支付测试
**测试目标**: 验证订单创建、支付流程

**测试步骤**:
1. 买家选择商品，点击"立即购买"
2. 填写收货地址和联系方式
3. 确认订单信息
4. 选择支付方式（Stripe）
5. 完成支付流程
6. 验证订单状态更新
7. 测试订单取消功能
8. 验证支付退款流程

**预期结果**:
- 订单成功创建，状态为PENDING_PAYMENT
- Stripe支付集成正常工作
- 支付成功后订单状态更新为PAID
- 订单信息在双方账户正确显示

**API端点**:
- `POST /orders`
- `POST /orders/{id}/pay`
- `PUT /orders/{id}/cancel`
- `GET /orders/my-orders`

---

### 7. 用户评价和反馈测试
**测试目标**: 验证交易完成后的评价系统

**测试步骤**:
1. 订单完成后，买家访问评价页面
2. 选择评分（1-5星）
3. 填写评价内容
4. 提交评价
5. 验证评价在商品页面显示
6. 测试举报功能
7. 验证管理员处理举报流程

**预期结果**:
- 评价成功提交并显示
- 卖家评分正确计算
- 举报功能正常工作
- 管理员可以处理举报

**API端点**:
- `POST /reviews`
- `POST /reports`
- `GET /items/{id}/reviews`

---

### 8. 多语言切换测试
**测试目标**: 验证中英文语言切换功能

**测试步骤**:
1. 访问网站首页
2. 点击语言切换按钮（EN/中文）
3. 验证页面文本切换为中文
4. 测试各个页面的语言切换
5. 验证货币显示（NZD）
6. 测试表单验证消息的语言
7. 验证语言偏好保存

**预期结果**:
- 页面文本正确切换语言
- 货币格式正确显示（NZD）
- 语言偏好正确保存
- 表单验证消息使用正确语言

**前端功能**:
- 语言切换组件
- i18n国际化配置
- 货币格式化

---

### 9. 管理员功能测试
**测试目标**: 验证管理员后台管理功能

**测试步骤**:
1. 以管理员身份登录
2. 访问管理员仪表板 `/admin`
3. 查看平台统计数据
4. 处理用户举报
5. 管理商品审核
6. 查看用户管理
7. 测试系统配置功能

**预期结果**:
- 管理员仪表板正确显示统计数据
- 举报处理功能正常
- 商品审核流程完整
- 用户管理功能正常

**API端点**:
- `GET /admin/dashboard`
- `GET /admin/reports`
- `POST /admin/reports/{id}/resolve`
- `GET /admin/users`

---

### 10. 性能和安全性测试
**测试目标**: 验证系统性能和安全性

**测试步骤**:
1. 测试大量并发用户访问
2. 测试文件上传大小限制
3. 测试SQL注入防护
4. 测试XSS攻击防护
5. 测试CSRF保护
6. 测试API速率限制
7. 测试数据验证和清理

**预期结果**:
- 系统在高并发下稳定运行
- 安全漏洞得到有效防护
- API响应时间在可接受范围
- 数据验证和清理正确执行

**安全测试点**:
- JWT令牌安全性
- 文件上传安全
- 输入验证
- 权限控制

---

## 🛠️ 测试工具推荐

### 自动化测试框架
- **前端**: Playwright, Cypress
- **后端**: JUnit 5, TestContainers
- **API**: REST Assured, Postman Newman
- **性能**: JMeter, K6

### 测试环境
- **容器化**: Docker Compose
- **数据库**: TestContainers PostgreSQL
- **缓存**: TestContainers Redis
- **存储**: TestContainers MinIO

### CI/CD集成
- **GitHub Actions**: 自动化测试执行
- **测试报告**: Allure, Jest Coverage
- **质量门禁**: SonarQube

---

## 📊 测试覆盖率目标

- **单元测试**: 80%+ 代码覆盖率
- **集成测试**: 核心业务流程 100% 覆盖
- **E2E测试**: 主要用户流程 100% 覆盖
- **性能测试**: 关键API响应时间 < 500ms
- **安全测试**: OWASP Top 10 漏洞 0 个

---

## 🚀 执行建议

1. **优先级**: 按业务重要性排序执行
2. **并行**: 前后端测试可并行执行
3. **数据**: 使用独立的测试数据库
4. **清理**: 每个测试后清理测试数据
5. **监控**: 实时监控测试执行状态
6. **报告**: 生成详细的测试报告

这些测试场景涵盖了您的二手商品交易平台的所有核心功能，确保系统的稳定性和用户体验质量。
